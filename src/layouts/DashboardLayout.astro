---
import '../styles/dashboard.css';
import { SignedIn, UserButton } from '@clerk/astro/components';

interface Props {
  title: string;
  description?: string;
  activePage: string;
}

const { title, description, activePage } = Astro.props;

const navigation = [
{ name: 'Dashboard', href: '/admin/dashboard', icon: 'home' },
{ name: 'Inventory', href: '/admin/inventory', icon: 'users' },
{ name: 'Orders', href: '/admin/orders', icon: 'folder' },
{ name: 'Testing', href: '/admin/testing', icon: 'folder' },
{ name: 'Site Health', href: '/admin/site-health', icon: 'folder' },
];
---

<html lang="en" class="h-full bg-[#0b1120]">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
  </head>
  <body class="h-full font-sans text-slate-400 antialiased">
    
    <div id="mobile-sidebar" class="relative z-50 lg:hidden hidden" role="dialog" aria-modal="true">
      <div class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm"></div>
      <div class="fixed inset-0 flex">
        <div class="relative mr-16 flex w-full max-w-xs flex-1">
          <div class="flex grow flex-col gap-y-5 overflow-y-auto bg-[#0f172a] px-6 pb-4 ring-1 ring-white/10">
            <div class="flex h-16 shrink-0 items-center justify-between">
                <a href="/admin"><div class="h-8 w-8 bg-indigo-500 rounded-lg flex items-center justify-center text-white italic">RL</div></a>
              <button type="button" id="close-sidebar" class="-m-2.5 p-2.5 text-slate-400">
                <span class="sr-only">Close sidebar</span>
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            <nav class="flex flex-1 flex-col">
              <ul role="list" class="flex flex-1 flex-col gap-y-7">
                <li>
                  <ul role="list" class="-mx-2 space-y-1">
                    {navigation.map((item) => (
                      <li>
                        <a href={item.href} class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-slate-400 hover:bg-slate-800 hover:text-white">
                          {item.name}
                        </a>
                      </li>
                    ))}
                  </ul>
                </li>
              </ul>
              <li class="mt-auto">
                <a href="#" class="flex items-center gap-x-4 py-3 text-sm font-semibold text-white hover:bg-slate-800 rounded-md transition px-2">
                  <SignedIn>
                    <UserButton appearance={{
                      elements: {
                        avatarBox: "border-2 border-red-600/50 hover:border-red-600 transition-colors",
                      }
                    }} />
                  </SignedIn>
                </a>
              </li>
            </nav>
          </div>
        </div>
      </div>
    </div>

    <div class="hidden lg:fixed lg:inset-y-0 lg:z-50 lg:flex lg:w-72 lg:flex-col">
      <div class="flex grow flex-col gap-y-5 overflow-y-auto bg-[#0f172a] px-6 pb-4 border-r border-slate-800">
        <div class="flex h-16 shrink-0 items-center">
            <a href="/admin"><div class="h-8 w-8 bg-indigo-500 rounded-lg flex items-center justify-center text-white font-bold italic">RL</div></a>
        </div>
        <nav class="flex flex-1 flex-col">
          <ul role="list" class="flex flex-1 flex-col gap-y-7">
            <li>
              <ul role="list" class="-mx-2 space-y-1">
                {navigation.map((item) => (
                  <li>
                    <a href={item.href} class:list={[
                      'group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 transition',
                      activePage === item.name ? 'bg-slate-800 text-white' : 'text-slate-400 hover:bg-slate-800 hover:text-white'
                    ]}>
                      {item.name}
                    </a>
                  </li>
                ))}
              </ul>
            </li>
            <li class="mt-auto">
              <a href="#" class="flex items-center gap-x-4 py-3 text-sm font-semibold text-white hover:bg-slate-800 rounded-md transition px-2">
                <SignedIn>
                  <UserButton
                    appearance={{
                      elements: {
                        avatarBox: "border-2 border-red-600/50 hover:border-red-600 transition-colors",
                        userButtonPopoverCard: "glass-dark border border-red-600/20"
                      }
                          }},
                  />
                </SignedIn>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>

    <div class="lg:pl-72">
      <div class="sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-slate-800 bg-[#0b1120] px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:hidden">
        <button type="button" id="open-sidebar" class="-m-2.5 p-2.5 text-slate-400 lg:hidden">
          <span class="sr-only">Open sidebar</span>
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </button>
        <div class="flex-1 text-sm font-semibold leading-6 text-white">{activePage}</div>
        <SignedIn>
          <UserButton appearance={{
            elements: {
              avatarBox: "border-2 border-red-600/50 hover:border-red-600 transition-colors",
            }
          }} />
        </SignedIn>
      </div>

      <main class="py-10">
        <div class="px-4 sm:px-6 lg:px-8">
          <div class="rounded-xl border-2 border-dashed border-slate-800 bg-slate-900/30 p-4">
            <slot />
          </div>
        </div>
      </main>
    </div>

    <script>
      // Zero-dependency Vanilla JS toggle
      const openBtn = document.getElementById('open-sidebar');
      const closeBtn = document.getElementById('close-sidebar');
      const sidebar = document.getElementById('mobile-sidebar');

      openBtn?.addEventListener('click', () => sidebar?.classList.remove('hidden'));
      closeBtn?.addEventListener('click', () => sidebar?.classList.add('hidden'));
    </script>
  </body>
</html>
