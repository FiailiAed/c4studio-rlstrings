---
import '../styles/admin.css';
import Analytics from '@vercel/analytics/astro';
import { UserButton, SignedIn } from '@clerk/astro/components';

interface Props {
  title?: string;
  description?: string;
  activePage?: string;
  pageTitle?: string;
}

const {
  title = 'RL Strings Admin',
  description = 'RL Strings Admin Dashboard',
  activePage = 'Dashboard',
  pageTitle = 'Dashboard',
} = Astro.props;

const { sessionClaims } = Astro.locals.auth();
const claims = sessionClaims as { name?: string; email?: string } | null;
const userName = claims?.name ?? 'Admin';
const userEmail = claims?.email ?? '';

const navLinks = [
  { label: 'Dashboard', href: '/admin/new' },
  { label: 'Orders', href: '/admin/new/orders' },
  { label: 'Inventory', href: '/admin/new/products' },
  { label: 'Kanban', href: '/admin/new/kanban' },
];
---

<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-900">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <title>{title}</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  </head>

  <body class="h-full">
    <div class="min-h-full">
      <!-- Top Navbar -->
      <nav class="bg-gray-800/50">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div class="flex h-16 items-center justify-between">
            <!-- Left: Logo + Desktop Nav -->
            <div class="flex items-center">
              <!-- Logo -->
              <div class="shrink-0">
                <a href="/admin/new" class="flex items-center gap-2">
                  <div class="w-8 h-8 bg-white/10 rounded flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10" />
                      <line x1="12" y1="2" x2="12" y2="22" />
                      <line x1="2" y1="12" x2="22" y2="12" />
                    </svg>
                  </div>
                  <span class="font-black italic uppercase text-sm text-white hidden sm:inline">RL Strings</span>
                </a>
              </div>

              <!-- Desktop Nav Links -->
              <div class="hidden md:block">
                <div class="ml-10 flex items-baseline space-x-4">
                  {navLinks.map(link => (
                    <a
                      href={link.href}
                      aria-current={link.label === activePage ? 'page' : undefined}
                      class={link.label === activePage
                        ? 'rounded-md bg-gray-950/50 px-3 py-2 text-sm font-medium text-white'
                        : 'rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-white/5 hover:text-white'}
                    >
                      {link.label}
                    </a>
                  ))}
                </div>
              </div>
            </div>

            <!-- Right: Notifications + Profile (desktop) -->
            <div class="hidden md:block">
              <div class="ml-4 flex items-center md:ml-6">
                <!-- Notifications Bell -->
                <button type="button" class="relative rounded-full p-1 text-gray-400 hover:text-white focus:outline-2 focus:outline-offset-2 focus:outline-white/50">
                  <span class="absolute -inset-1.5"></span>
                  <span class="sr-only">View notifications</span>
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true" class="size-6">
                    <path d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                </button>

                <!-- Clerk UserButton -->
                <div class="relative ml-3">
                  <SignedIn>
                    <UserButton />
                  </SignedIn>
                </div>
              </div>
            </div>

            <!-- Mobile Menu Button -->
            <div class="-mr-2 flex md:hidden">
              <button
                id="mobile-menu-btn"
                type="button"
                class="relative inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-white/5 hover:text-white focus:outline-2 focus:outline-offset-2 focus:outline-white/50"
                aria-expanded="false"
              >
                <span class="absolute -inset-0.5"></span>
                <span class="sr-only">Open main menu</span>
                <svg id="menu-icon-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true" class="size-6">
                  <path d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <svg id="menu-icon-close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true" class="size-6 hidden">
                  <path d="M6 18 18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden">
          <div class="space-y-1 px-2 pt-2 pb-3 sm:px-3">
            {navLinks.map(link => (
              <a
                href={link.href}
                aria-current={link.label === activePage ? 'page' : undefined}
                class={link.label === activePage
                  ? 'block rounded-md bg-gray-950/50 px-3 py-2 text-base font-medium text-white'
                  : 'block rounded-md px-3 py-2 text-base font-medium text-gray-300 hover:bg-white/5 hover:text-white'}
              >
                {link.label}
              </a>
            ))}
          </div>
          <div class="border-t border-white/10 pt-4 pb-3">
            <div class="flex items-center px-5">
              <div class="shrink-0">
                <SignedIn>
                  <UserButton />
                </SignedIn>
              </div>
              <div class="ml-3">
                <div class="text-base/5 font-medium text-white">{userName}</div>
                <div class="text-sm font-medium text-gray-400">{userEmail}</div>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <!-- Page Header -->
      <header class="relative bg-gray-800 after:pointer-events-none after:absolute after:inset-x-0 after:inset-y-0 after:border-y after:border-white/10">
        <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
          <h1 class="text-3xl font-bold tracking-tight text-white">{pageTitle}</h1>
        </div>
      </header>

      <!-- Main Content -->
      <main>
        <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
          <slot />
        </div>
      </main>
    </div>

    <!-- Mobile menu toggle script -->
    <script>
      const btn = document.getElementById('mobile-menu-btn');
      const menu = document.getElementById('mobile-menu');
      const iconOpen = document.getElementById('menu-icon-open');
      const iconClose = document.getElementById('menu-icon-close');

      btn?.addEventListener('click', () => {
        const isOpen = !menu?.classList.contains('hidden');
        menu?.classList.toggle('hidden', isOpen);
        iconOpen?.classList.toggle('hidden', !isOpen);
        iconClose?.classList.toggle('hidden', isOpen);
        btn.setAttribute('aria-expanded', String(!isOpen));
      });
    </script>

    <Analytics />
  </body>
</html>
