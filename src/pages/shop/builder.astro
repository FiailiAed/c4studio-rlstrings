---
import MainLayout from '../../layouts/MainLayout.astro';
import type { ProductCardData } from '../../components/StripeShopCheckout';
import StripeShopCheckout from '../../components/StripeShopCheckout';
import { ConvexHttpClient } from 'convex/browser';
import { api } from '../../../convex/_generated/api';

const convexUrl = import.meta.env.PUBLIC_CONVEX_URL;
const client = new ConvexHttpClient(convexUrl);
const builderItems = await client.query(api.inventory.getBuilderProducts, {});

const products: ProductCardData[] = builderItems.map((item) => ({
  id: item._id,
  name: item.name,
  description: item.description ?? null,
  images: item.images ?? [],
  priceId: item.priceId ?? null,
  priceAmount: item.unitAmount ?? null,
  priceCurrency: item.currency ?? 'usd',
  priceType: item.priceType === 'recurring' ? 'recurring' : 'one_time',
}));
---

<MainLayout
  title="RL Strings | Pocket Builder"
  description="Stop settling for factory trash. Custom built, professionally strung."
>

  <section>
      <!-- Headline -->
      <h1 class="text-6xl md:text-8xl font-black tracking-tighter mb-6 leading-[0.9] uppercase">
        This is the <span class="text-transparent bg-clip-text bg-gradient-to-br from-red-500 to-red-700">BUILDER.</span>
      </h1>
  </section>
  <StripeShopCheckout client:load products={products} convexUrl={convexUrl} />

</MainLayout>
