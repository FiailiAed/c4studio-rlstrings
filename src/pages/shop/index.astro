---
import MainLayout from '../../layouts/MainLayout.astro';

import { getProducts } from '../../lib/stripe'
import type { ProductCardData } from '../../components/StripeShopCheckout';
import StripeShopCheckout from '../../components/StripeShopCheckout';

const rawProducts = await getProducts();

const products: ProductCardData[] = rawProducts.map((p) => {
  const price = p.default_price;
  return {
    id: p.id,
    name: p.name,
    description: p.description,
    images: p.images,
    priceId: price?.id ?? null,
    priceAmount: price?.unit_amount ?? null,
    priceCurrency: price?.currency ?? 'usd',
    priceType: price?.type === 'recurring' ? 'recurring' : 'one_time',
  };
});

const convexUrl = import.meta.env.PUBLIC_CONVEX_URL;
---

<MainLayout
  title="RL Strings | Shop"
  description="Stop settling for factory trash. Custom built, professionally strung."
>

  <section>
      <!-- Headline -->
      <h1 class="text-6xl md:text-8xl font-black tracking-tighter mb-6 leading-[0.9] uppercase">
        This is the <span class="text-transparent bg-clip-text bg-gradient-to-br from-red-500 to-red-700">SHOP.</span>
      </h1>
  </section>
  <StripeShopCheckout client:load products={products} convexUrl={convexUrl} />

</MainLayout>
