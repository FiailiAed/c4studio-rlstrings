---
interface Props {
  class?: string;
}
const { class: className = '' } = Astro.props;
---
<div class:list={["island-loader relative", className]}>
  <div class="island-placeholder flex items-center justify-center py-8">
    <svg class="animate-spin h-6 w-6 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
    </svg>
  </div>
  <slot />
</div>

<script>
  document.querySelectorAll('.island-loader').forEach(loader => {
    const island = loader.querySelector('astro-island');
    if (!island) return;
    const placeholder = loader.querySelector('.island-placeholder');
    if (!placeholder) return;

    const hide = () => { (placeholder as HTMLElement).style.display = 'none'; };

    if (island.children.length > 0 && !(island.children[0] instanceof HTMLTemplateElement)) {
      hide();
      return;
    }

    const observer = new MutationObserver(() => {
      if (island.children.length > 0 && !(island.children[0] instanceof HTMLTemplateElement)) {
        hide();
        observer.disconnect();
      }
    });
    observer.observe(island, { childList: true });
  });
</script>
